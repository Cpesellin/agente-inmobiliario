<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Inmobiliaria House Â· Propiedades</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Fraunces:ital,wght@0,600;0,700;0,900;1,600;1,700&display=swap" rel="stylesheet">
<style>
:root{
  --g50:#f8fafc;--g100:#f1f5f9;--g200:#e2e8f0;--g300:#cbd5e1;
  --g400:#94a3b8;--g500:#64748b;--g600:#475569;--g700:#334155;--g800:#1e293b;--g900:#0f172a;
  --b50:#eff6ff;--b100:#dbeafe;--b200:#bfdbfe;--b300:#93c5fd;
  --b400:#60a5fa;--b500:#3b82f6;--b600:#2563eb;--b700:#1d4ed8;--b800:#1e40af;--b900:#1e3a8a;
  --green:#10b981;--greenbg:#ecfdf5;--greenborder:rgba(16,185,129,0.2);
  --red:#ef4444;--redbg:#fef2f2;--redborder:rgba(239,68,68,0.2);
  --gold:#f59e0b;--goldbg:#fffbeb;--goldborder:rgba(245,158,11,0.2);
  --purple:#8b5cf6;--purplebg:#f5f3ff;
  --shadow-sm:0 1px 3px rgba(0,0,0,0.07),0 1px 2px rgba(0,0,0,0.04);
  --shadow-lg:0 12px 40px rgba(0,0,0,0.12);
  --r:14px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--g50);color:var(--g800);min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--g100)}::-webkit-scrollbar-thumb{background:var(--b300);border-radius:3px}

/* â•â• HEADER â•â• */
header{position:sticky;top:0;z-index:100;background:rgba(255,255,255,0.97);backdrop-filter:blur(16px);border-bottom:1px solid var(--g200);box-shadow:var(--shadow-sm)}
.nav{max-width:1200px;margin:0 auto;padding:0 20px;height:62px;display:flex;align-items:center;justify-content:space-between;gap:12px}
.logo-wrap{display:flex;align-items:center;gap:10px;text-decoration:none}
.logo-svg{width:38px;height:38px;flex-shrink:0}
.logo-texts{display:flex;flex-direction:column;line-height:1}
.logo-main{font-family:'Fraunces',serif;font-size:16px;font-weight:700;color:var(--g900)}
.logo-sub{font-size:9px;font-weight:700;color:var(--b600);letter-spacing:2.5px;text-transform:uppercase;margin-top:2px}
.live-badge{display:flex;align-items:center;gap:5px;background:var(--greenbg);border:1px solid var(--greenborder);border-radius:20px;padding:5px 11px;font-size:11px;font-weight:700;color:var(--green)}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.4}}

/* â•â• HERO â•â• */
.hero{background:linear-gradient(155deg,var(--b900) 0%,var(--b700) 50%,var(--b600) 100%);padding:48px 20px 52px;text-align:center;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/svg%3E");pointer-events:none}
.hero-inner{position:relative;z-index:1;max-width:620px;margin:0 auto}
.hero-eyebrow{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.2);border-radius:20px;padding:5px 14px;font-size:11.5px;font-weight:600;color:rgba(255,255,255,0.9);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:18px}
.hero h1{font-family:'Fraunces',serif;font-size:clamp(28px,6vw,50px);font-weight:900;color:white;line-height:1.1;letter-spacing:-1px;margin-bottom:10px}
.hero h1 em{font-style:italic;color:#bfdbfe}
.hero-sub{font-size:14px;color:rgba(255,255,255,0.7);margin-bottom:32px}
.stats-row{display:flex;justify-content:center;flex-wrap:wrap;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);border-radius:var(--r);overflow:hidden;max-width:480px;margin:0 auto}
.stat{flex:1;min-width:100px;padding:16px 10px;border-right:1px solid rgba(255,255,255,0.1);text-align:center}
.stat:last-child{border-right:none}
.stat-n{font-family:'Fraunces',serif;font-size:26px;font-weight:700;color:white;line-height:1}
.stat-l{font-size:10px;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:1px;margin-top:3px}

/* â•â• SEARCH â•â• */
.search-wrap{background:white;border-bottom:2px solid var(--g200);padding:16px 20px;box-shadow:var(--shadow-sm)}
.search-wrap-inner{max-width:1200px;margin:0 auto}
.sinput-wrap{position:relative}
.sinput{width:100%;padding:14px 52px 14px 48px;border:2px solid var(--g200);border-radius:12px;background:var(--g50);color:var(--g800);font-family:'Plus Jakarta Sans',sans-serif;font-size:14.5px;transition:all 0.2s}
.sinput:focus{outline:none;border-color:var(--b500);background:white;box-shadow:0 0 0 4px rgba(59,130,246,0.1)}
.sinput::placeholder{color:var(--g400)}
.sico-left{position:absolute;left:15px;top:50%;transform:translateY(-50%);font-size:17px;pointer-events:none}
.sgo{position:absolute;right:7px;top:50%;transform:translateY(-50%);background:var(--b600);border:none;border-radius:8px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:white;font-size:16px;transition:all 0.2s}
.sgo:hover{background:var(--b700)}

/* â•â• STATUS â•â• */
.status-bar{background:white;border-bottom:1px solid var(--g100)}
.status-inner{max-width:1200px;margin:0 auto;padding:8px 20px;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.sbadge{display:inline-flex;align-items:center;gap:5px;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:700}
.sb-ok{background:var(--greenbg);color:var(--green);border:1px solid var(--greenborder)}
.sb-load{background:var(--b50);color:var(--b700);border:1px solid var(--b200)}
.sb-err{background:var(--redbg);color:var(--red);border:1px solid var(--redborder)}
.sb-spin{display:inline-block;animation:spin 1s linear infinite;font-style:normal}
@keyframes spin{to{transform:rotate(360deg)}}
#status-time{font-size:11px;color:var(--g400)}
.reload-btn{margin-left:auto;display:none;align-items:center;gap:5px;background:var(--b600);color:white;border:none;padding:5px 13px;border-radius:20px;font-size:12px;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;transition:all 0.2s}
.reload-btn:hover{background:var(--b700)}

/* â•â• APP â•â• */
.app{max-width:1200px;margin:0 auto;padding:20px 16px 80px}

/* â•â• CARD â•â• */
.card{background:white;border:1px solid var(--g200);border-radius:var(--r);box-shadow:var(--shadow-sm);overflow:hidden;margin-bottom:16px}
.card-head{padding:16px 20px;border-bottom:1px solid var(--g100);display:flex;align-items:center;justify-content:space-between;gap:12px}
.card-head-left{display:flex;align-items:center;gap:12px}
.ch-icon{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;background:var(--b50)}
.ch-title{font-family:'Fraunces',serif;font-size:17px;font-weight:700;color:var(--g800)}
.ch-sub{font-size:11.5px;color:var(--g400);margin-top:1px}
.btn-limpiar-top{display:flex;align-items:center;gap:5px;padding:7px 14px;border:1.5px solid var(--g200);border-radius:8px;background:white;color:var(--g600);font-family:'Plus Jakarta Sans',sans-serif;font-size:12.5px;font-weight:700;cursor:pointer;transition:all 0.2s;white-space:nowrap}
.btn-limpiar-top:hover{background:var(--redbg);color:var(--red);border-color:var(--redborder)}
.card-body{padding:18px 20px}

/* â•â• CHIPS â•â• */
.fgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.fsec{background:var(--g50);border:1px solid var(--g100);border-radius:10px;padding:13px}
.fsec.full{grid-column:1/-1}
.flabel{font-size:10px;font-weight:800;letter-spacing:1.8px;text-transform:uppercase;color:var(--g500);margin-bottom:9px}
.chips{display:flex;flex-wrap:wrap;gap:6px}
.chip{display:inline-flex;align-items:center;gap:4px;padding:7px 13px;border-radius:20px;font-size:12.5px;font-weight:600;cursor:pointer;border:1.5px solid var(--g200);background:white;color:var(--g600);transition:border-color .15s,background .15s,color .15s;user-select:none;white-space:nowrap}
.chip:hover:not(.active){border-color:var(--b400);color:var(--b600);background:var(--b50)}
.chip.active{border-color:var(--b500);color:var(--b700);background:var(--b50);font-weight:700}
.chip.active.col-green{border-color:var(--green);color:#065f46;background:var(--greenbg)}
.chip.active.col-gold{border-color:var(--gold);color:#92400e;background:var(--goldbg)}
.chip.active.col-purple{border-color:var(--purple);color:#5b21b6;background:var(--purplebg)}

/* â•â• DUAL RANGE SLIDER â•â• */
.slider-block{
  background:var(--g50);border:1px solid var(--g100);
  border-radius:10px;padding:20px 20px 16px;
  grid-column:1/-1;
}
.slider-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:20px;gap:8px;flex-wrap:wrap}
.slider-title{font-size:10px;font-weight:800;letter-spacing:1.8px;text-transform:uppercase;color:var(--g500);padding-top:4px}
.range-pill{
  background:white;border:1.5px solid var(--b300);
  border-radius:20px;padding:6px 16px;
  font-size:13.5px;font-weight:800;color:var(--b700);
  transition:all .2s;box-shadow:0 1px 4px rgba(37,99,235,0.1);
  text-align:right;
}
.range-pill.inactive{border-color:var(--g200);color:var(--g400);background:var(--g50);box-shadow:none;font-weight:500;font-size:12px}
.range-pill.green{border-color:var(--green);color:#065f46;background:var(--greenbg);box-shadow:0 1px 4px rgba(16,185,129,0.15)}
.range-pill.green.inactive{border-color:var(--g200);color:var(--g400);background:var(--g50);box-shadow:none}

/* Contenedor del dual range â€” inputs superpuestos */
.drs-wrap{position:relative;height:44px;padding:0 6px}

/* Track visual debajo */
.drs-track-bg{
  position:absolute;left:6px;right:6px;
  top:50%;transform:translateY(-50%);
  height:6px;background:var(--g200);border-radius:3px;
  pointer-events:none;
}
.drs-track-fill{
  position:absolute;top:50%;transform:translateY(-50%);
  height:6px;border-radius:3px;
  background:linear-gradient(90deg,var(--b400),var(--b600));
  pointer-events:none;transition:left .05s,width .05s;
}
.drs-track-fill.green-fill{background:linear-gradient(90deg,#34d399,var(--green))}

/* Los dos inputs range superpuestos */
.drs-input{
  position:absolute;left:0;right:0;top:50%;
  transform:translateY(-50%);
  width:100%;height:100%;
  -webkit-appearance:none;appearance:none;
  background:transparent;outline:none;
  pointer-events:none;
}
/* Solo el thumb recibe clicks */
.drs-input::-webkit-slider-thumb{
  -webkit-appearance:none;appearance:none;
  width:26px;height:26px;border-radius:50%;
  background:white;border:3px solid var(--b600);
  box-shadow:0 2px 10px rgba(37,99,235,0.35);
  cursor:grab;pointer-events:all;
  transition:transform .15s,box-shadow .15s;
}
.drs-input::-webkit-slider-thumb:hover{transform:scale(1.15);box-shadow:0 4px 16px rgba(37,99,235,0.45)}
.drs-input:active::-webkit-slider-thumb{cursor:grabbing;transform:scale(1.2)}
.drs-input::-moz-range-thumb{
  width:26px;height:26px;border-radius:50%;
  background:white;border:3px solid var(--b600);
  box-shadow:0 2px 10px rgba(37,99,235,0.35);
  cursor:grab;pointer-events:all;
}
/* VersiÃ³n verde para venta */
.drs-input.green-input::-webkit-slider-thumb{border-color:var(--green);box-shadow:0 2px 10px rgba(16,185,129,0.35)}
.drs-input.green-input::-webkit-slider-thumb:hover{box-shadow:0 4px 16px rgba(16,185,129,0.45)}
.drs-input.green-input::-moz-range-thumb{border-color:var(--green);box-shadow:0 2px 10px rgba(16,185,129,0.35)}
/* El thumb de "hi" encima del "lo" */
.drs-input.hi{z-index:2}
.drs-input.lo{z-index:1}

/* Ticks */
.drs-ticks{display:flex;justify-content:space-between;margin-top:4px;padding:0 4px}
.drs-tick{font-size:9.5px;color:var(--g400);font-weight:600}

/* â•â• PANEL SELECCIÃ“N â•â• */
.seleccion-panel{margin-top:14px;background:linear-gradient(135deg,var(--b50),#f0f7ff);border:1.5px solid var(--b200);border-radius:10px;padding:12px 14px;display:none}
.seleccion-panel.visible{display:block}
.seleccion-titulo{font-size:10px;font-weight:800;letter-spacing:1.8px;text-transform:uppercase;color:var(--b600);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.seleccion-titulo::before{content:'âœ¦';font-size:8px}
.seleccion-tags{display:flex;flex-wrap:wrap;gap:6px}
.stag{display:inline-flex;align-items:center;gap:5px;background:white;border:1.5px solid var(--b300);color:var(--b700);border-radius:20px;padding:4px 11px;font-size:12px;font-weight:700;box-shadow:0 1px 3px rgba(37,99,235,0.1)}
.stag .x{cursor:pointer;color:var(--b400);font-size:11px;margin-left:2px;transition:color .15s}
.stag .x:hover{color:var(--red)}

/* â•â• BOTONES â•â• */
.btn-row{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
.btn{display:flex;align-items:center;justify-content:center;gap:6px;padding:12px 20px;border:none;border-radius:9px;font-family:'Plus Jakarta Sans',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;flex:1}
.btn-primary{background:var(--b600);color:white;box-shadow:0 2px 10px rgba(37,99,235,0.3)}
.btn-primary:hover{background:var(--b700);transform:translateY(-1px);box-shadow:0 4px 16px rgba(37,99,235,0.4)}
.btn-secondary{background:var(--g100);color:var(--g700);border:1px solid var(--g200);flex:0 0 auto}
.btn-secondary:hover{background:var(--g200)}
.btn-danger{background:var(--redbg);color:var(--red);border:1.5px solid var(--redborder);flex:0 0 auto}
.btn-danger:hover{background:#fee2e2;border-color:var(--red)}

/* â•â• RESULTADOS â•â• */
.rhead{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px}
.rcount{font-family:'Fraunces',serif;font-size:20px;font-weight:700;color:var(--g800)}
.rcount b{color:var(--b600)}
.rsort{font-size:11px;color:var(--g500);background:white;border:1px solid var(--g200);padding:5px 11px;border-radius:7px}
.pgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:14px}

/* â•â• TARJETAS â•â• */
.pc{background:white;border:1px solid var(--g200);border-radius:var(--r);overflow:hidden;transition:all .25s;animation:fadeUp .35s ease both;box-shadow:var(--shadow-sm)}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.pc:hover{border-color:var(--b300);transform:translateY(-4px);box-shadow:var(--shadow-lg)}
.pctop{padding:16px 18px;position:relative;overflow:hidden;min-height:90px}
.pctop::after{content:'';position:absolute;bottom:-25px;right:-25px;width:110px;height:110px;border-radius:50%;background:rgba(255,255,255,0.1)}
.pctop.tv{background:linear-gradient(135deg,var(--b800),var(--b600))}
.pctop.ta{background:linear-gradient(135deg,#065f46,#059669)}
.pctop.tb{background:linear-gradient(135deg,#7c2d12,#c2410c)}
.pctop-type{font-size:9.5px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.6);position:relative;z-index:1;margin-bottom:4px}
.pc-emoji{font-size:20px;position:relative;z-index:1;margin-bottom:4px}
.pc-city-main{font-size:15px;font-weight:800;color:white;line-height:1.2;position:relative;z-index:1;margin-bottom:2px}
.pc-city-sub{font-size:11px;color:rgba(255,255,255,0.7);position:relative;z-index:1}
.pc-cod{position:absolute;top:11px;right:11px;font-size:10px;background:rgba(0,0,0,0.3);color:rgba(255,255,255,0.9);padding:2px 8px;border-radius:5px;font-weight:700;z-index:1}
.pcbody{padding:13px 15px}
.mods{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:9px}
.mbadge{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:5px;font-size:11px;font-weight:800}
.mbv{background:var(--b50);color:var(--b700);border:1px solid var(--b200)}
.mba{background:var(--greenbg);color:#065f46;border:1px solid var(--greenborder)}
.mbok{background:var(--greenbg);color:#065f46;border:1px solid var(--greenborder)}
.pblock{background:var(--g50);border-radius:8px;padding:10px 12px;margin:7px 0;border:1px solid var(--g100)}
.pventa{font-family:'Fraunces',serif;font-size:21px;font-weight:700;color:var(--b700);line-height:1}
.pventa small{font-size:10.5px;font-weight:400;color:var(--g500);font-family:'Plus Jakarta Sans',sans-serif}
.parriendo{font-size:14px;font-weight:700;color:#065f46;margin-top:4px}
.parriendo small{font-size:10.5px;font-weight:400;color:var(--g500)}
.admon{font-size:11px;color:var(--g400);margin-top:3px}
.cross-tag{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:5px;font-size:11px;font-weight:700;margin-top:4px}
.cross-v{background:var(--b50);color:var(--b700);border:1px solid var(--b200)}
.cross-a{background:var(--greenbg);color:#065f46;border:1px solid var(--greenborder)}
.specs{display:flex;flex-wrap:wrap;gap:4px;margin-top:9px;padding-top:9px;border-top:1px solid var(--g100)}
.spec{font-size:11px;color:var(--g600);background:var(--g50);padding:3px 8px;border-radius:5px;border:1px solid var(--g200)}
.dalert{background:var(--goldbg);border:1px solid var(--goldborder);border-radius:7px;padding:7px 10px;font-size:11px;color:#92400e;margin-top:7px;line-height:1.5}
.asesor{font-size:11.5px;color:var(--g500);margin-top:7px;display:flex;align-items:center;gap:4px}
.ver-mas-btn{width:100%;margin-top:10px;padding:9px 14px;background:white;border:1.5px solid var(--b200);border-radius:8px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12.5px;font-weight:700;color:var(--b600);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:6px}
.ver-mas-btn:hover{background:var(--b50);border-color:var(--b400)}

/* â•â• MODAL â•â• */
.modal-overlay{position:fixed;inset:0;z-index:500;background:rgba(15,23,42,0.6);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;padding:16px;animation:fadeIn .2s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-box{background:white;border-radius:20px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;box-shadow:0 32px 80px rgba(0,0,0,0.3);animation:slideUp .25s cubic-bezier(0.34,1.3,0.64,1)}
@keyframes slideUp{from{opacity:0;transform:translateY(30px) scale(0.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.modal-header{padding:20px 22px 16px;border-bottom:1px solid var(--g100);display:flex;align-items:flex-start;justify-content:space-between;gap:12px;position:sticky;top:0;background:white;z-index:1;border-radius:20px 20px 0 0}
.modal-title{font-family:'Fraunces',serif;font-size:20px;font-weight:700;color:var(--g900);line-height:1.2}
.modal-subtitle{font-size:12px;color:var(--g500);margin-top:3px}
.modal-close{width:32px;height:32px;border-radius:8px;border:1px solid var(--g200);background:var(--g50);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--g500);transition:all .2s;flex-shrink:0}
.modal-close:hover{background:var(--redbg);color:var(--red);border-color:var(--redborder)}
.modal-body{padding:18px 22px 22px}
.modal-section{margin-bottom:18px}
.modal-sec-title{font-size:10px;font-weight:800;letter-spacing:2px;text-transform:uppercase;color:var(--g400);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--g100)}
.modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.modal-field{background:var(--g50);border:1px solid var(--g100);border-radius:9px;padding:10px 12px}
.modal-field-label{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--g400);margin-bottom:3px}
.modal-field-value{font-size:13.5px;font-weight:600;color:var(--g800)}
.modal-field.full{grid-column:1/-1}
.modal-field.hl-blue{background:var(--b50);border-color:var(--b200)}
.modal-field.hl-blue .modal-field-value{color:var(--b700);font-family:'Fraunces',serif;font-size:20px;font-weight:700}
.modal-field.hl-green{background:var(--greenbg);border-color:var(--greenborder)}
.modal-field.hl-green .modal-field-value{color:#065f46;font-family:'Fraunces',serif;font-size:18px;font-weight:700}
.modal-obs{background:var(--g50);border:1px solid var(--g200);border-radius:9px;padding:12px 14px;font-size:13px;color:var(--g700);line-height:1.6;border-left:3px solid var(--b400)}
.empty{text-align:center;padding:56px 20px;background:white;border:1px solid var(--g200);border-radius:var(--r)}
.empty-ico{font-size:44px;display:block;margin-bottom:12px;opacity:.45}
.empty h3{font-family:'Fraunces',serif;font-size:21px;font-weight:700;color:var(--g800);margin-bottom:5px}
.empty p{color:var(--g500);font-size:13.5px}
.loader{text-align:center;padding:50px}
.ldots{display:inline-flex;gap:8px;margin-bottom:10px}
.ldot{width:9px;height:9px;border-radius:50%;background:var(--b400);animation:lb 1.2s infinite ease-in-out}
.ldot:nth-child(1){animation-delay:-.24s}.ldot:nth-child(2){animation-delay:-.12s}
@keyframes lb{0%,80%,100%{transform:scale(0.6);opacity:.3}40%{transform:scale(1.3);opacity:1}}
footer{background:white;border-top:1px solid var(--g200);padding:24px 20px;text-align:center}
.footer-logo{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:5px}
.footer-brand{font-family:'Fraunces',serif;font-size:15px;font-weight:700;color:var(--g700)}
.footer-sub{font-size:11.5px;color:var(--g400)}

/* â•â• RESPONSIVE â•â• */
@media(max-width:640px){
  .fgrid{grid-template-columns:1fr}.fsec.full,.slider-block{grid-column:1}
  .pgrid{grid-template-columns:1fr}.modal-grid{grid-template-columns:1fr}.modal-field.full{grid-column:1}
  .btn-row{flex-direction:column}.btn-secondary,.btn-danger{flex:1}
  .hero{padding:36px 16px 44px}.hero h1{font-size:27px}
  .stat-n{font-size:22px}.logo-sub{display:none}
  .nav{padding:0 14px}.app{padding:14px 10px 60px}
  .card-head{flex-wrap:wrap;gap:8px}
}
@media(max-width:360px){
  .stats-row{flex-direction:column}
  .stat{border-right:none!important;border-bottom:1px solid rgba(255,255,255,.1);padding:10px}
  .stat:last-child{border-bottom:none}
}
</style>
</head>
<body>

<header>
  <div class="nav">
    <a class="logo-wrap" href="#">
      <svg class="logo-svg" viewBox="0 0 40 40" fill="none">
        <defs><linearGradient id="lg1" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#1d4ed8"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient></defs>
        <rect width="40" height="40" rx="10" fill="url(#lg1)"/>
        <polygon points="20,7 32,18 8,18" fill="white" opacity="0.95"/>
        <rect x="12" y="18" width="16" height="13" rx="1" fill="white" opacity="0.85"/>
        <rect x="17" y="24" width="6" height="7" rx="1.5" fill="#1e40af"/>
        <rect x="13.5" y="20" width="4" height="3.5" rx="0.8" fill="#1e40af" opacity="0.7"/>
        <rect x="22.5" y="20" width="4" height="3.5" rx="0.8" fill="#1e40af" opacity="0.7"/>
        <polyline points="28,12 33,7 33,12" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" opacity="0.65"/>
        <line x1="27" y1="13" x2="33" y2="7" stroke="white" stroke-width="1.6" stroke-linecap="round" opacity="0.65"/>
      </svg>
      <div class="logo-texts">
        <span class="logo-main">Inmobiliaria House</span>
        <span class="logo-sub">Pereira Â· Eje Cafetero</span>
      </div>
    </a>
    <div class="live-badge"><span class="live-dot"></span> En vivo</div>
  </div>
</header>

<div class="hero">
  <div class="hero-inner">
    <div class="hero-eyebrow">ğŸ™ï¸ Portafolio en tiempo real</div>
    <h1>Tu prÃ³xima <em>propiedad</em><br>te estÃ¡ esperando</h1>
    <p class="hero-sub">Solo propiedades disponibles Â· Pereira y Eje Cafetero</p>
    <div class="stats-row">
      <div class="stat"><div class="stat-n" id="hs1">â€”</div><div class="stat-l">Total</div></div>
      <div class="stat"><div class="stat-n" id="hs2">â€”</div><div class="stat-l">Venta</div></div>
      <div class="stat"><div class="stat-n" id="hs3">â€”</div><div class="stat-l">Arriendo</div></div>
      <div class="stat"><div class="stat-n" id="hs4">â€”</div><div class="stat-l">Ambas</div></div>
    </div>
  </div>
</div>

<div class="search-wrap">
  <div class="search-wrap-inner">
    <div class="sinput-wrap">
      <span class="sico-left">ğŸ”</span>
      <input class="sinput" id="q" placeholder="Busca libremente: ciudad, tipo, caracterÃ­sticas... ej: apartamento 3 hab Pereira" onkeypress="if(event.key==='Enter')buscar()">
      <button class="sgo" onclick="buscar()">â†’</button>
    </div>
  </div>
</div>

<div class="status-bar">
  <div class="status-inner">
    <span id="status-badge" class="sbadge sb-load"><em class="sb-spin">âŸ³</em> Cargando...</span>
    <span id="status-time"></span>
    <button class="reload-btn" id="reload-btn" onclick="iniciarCarga()">â†º Actualizar</button>
  </div>
</div>

<div class="app">
  <div class="card">
    <div class="card-head">
      <div class="card-head-left">
        <div class="ch-icon">âš™ï¸</div>
        <div>
          <div class="ch-title">Filtros de BÃºsqueda</div>
          <div class="ch-sub">Combinaciones mÃºltiples Â· Solo disponibles</div>
        </div>
      </div>
      <button class="btn-limpiar-top" onclick="limpiar()">âœ• Limpiar todo</button>
    </div>
    <div class="card-body">
      <div class="fgrid">

        <!-- NEGOCIACIÃ“N -->
        <div class="fsec">
          <div class="flabel">NegociaciÃ³n</div>
          <div class="chips">
            <div class="chip" data-g="neg" data-v="venta"    data-col="col-green"  onclick="toggle(this)">ğŸ’° Venta</div>
            <div class="chip" data-g="neg" data-v="arriendo" data-col="col-blue"   onclick="toggle(this)">ğŸ”‘ Arriendo</div>
            <div class="chip" data-g="neg" data-v="ambas"    data-col="col-gold"   onclick="toggle(this)">ğŸ”„ Ambas</div>
          </div>
        </div>

        <!-- CIUDAD -->
        <div class="fsec">
          <div class="flabel">Ciudad / Sector</div>
          <div class="chips">
            <div class="chip" data-g="ciu" data-v="pereira"      data-col="col-blue" onclick="toggle(this)">ğŸ“ Pereira</div>
            <div class="chip" data-g="ciu" data-v="dosquebradas" data-col="col-blue" onclick="toggle(this)">ğŸ“ Dosquebradas</div>
            <div class="chip" data-g="ciu" data-v="santa rosa"   data-col="col-blue" onclick="toggle(this)">ğŸ“ Santa Rosa</div>
            <div class="chip" data-g="ciu" data-v="alcala"       data-col="col-blue" onclick="toggle(this)">ğŸ“ AlcalÃ¡</div>
            <div class="chip" data-g="ciu" data-v="cerritos"     data-col="col-blue" onclick="toggle(this)">ğŸ“ Cerritos</div>
          </div>
        </div>

        <!-- TIPO -->
        <div class="fsec full">
          <div class="flabel">Tipo de Inmueble</div>
          <div class="chips">
            <div class="chip" data-g="tipo" data-v="apartamento"    data-col="col-blue"   onclick="toggle(this)">ğŸ¢ Apartamento</div>
            <div class="chip" data-g="tipo" data-v="aparta estudio" data-col="col-blue"   onclick="toggle(this)">ğŸ  Apartaestudio</div>
            <div class="chip" data-g="tipo" data-v="casa"           data-col="col-purple" onclick="toggle(this)">ğŸ¡ Casa</div>
            <div class="chip" data-g="tipo" data-v="casa campestre" data-col="col-purple" onclick="toggle(this)">ğŸŒ¿ Campestre</div>
            <div class="chip" data-g="tipo" data-v="finca"          data-col="col-green"  onclick="toggle(this)">ğŸŒ¾ Finca</div>
            <div class="chip" data-g="tipo" data-v="local"          data-col="col-gold"   onclick="toggle(this)">ğŸª Local</div>
            <div class="chip" data-g="tipo" data-v="oficina"        data-col="col-blue"   onclick="toggle(this)">ğŸ’¼ Oficina</div>
            <div class="chip" data-g="tipo" data-v="bodega"         data-col="col-blue"   onclick="toggle(this)">ğŸ­ Bodega</div>
            <div class="chip" data-g="tipo" data-v="lote"           data-col="col-green"  onclick="toggle(this)">ğŸŒ³ Lote</div>
            <div class="chip" data-g="tipo" data-v="penthouse"      data-col="col-gold"   onclick="toggle(this)">ğŸ‘‘ Penthouse</div>
          </div>
        </div>

        <!-- SLIDER ARRIENDO â€” ancho completo, encima -->
        <div class="slider-block full">
          <div class="slider-top">
            <span class="slider-title">ğŸ”‘ Rango Precio Arriendo / mes</span>
            <span class="range-pill inactive" id="arr-pill">Arrastra las manijas para filtrar</span>
          </div>
          <div class="drs-wrap" id="drs-arr">
            <div class="drs-track-bg"></div>
            <div class="drs-track-fill" id="arr-fill" style="left:0%;width:100%"></div>
            <input id="arr-lo" class="drs-input lo" type="range" min="0" max="20" value="0" step="1">
            <input id="arr-hi" class="drs-input hi" type="range" min="0" max="20" value="20" step="1">
          </div>
          <div class="drs-ticks">
            <span class="drs-tick">$0</span>
            <span class="drs-tick">$2.5M</span>
            <span class="drs-tick">$5M</span>
            <span class="drs-tick">$7.5M</span>
            <span class="drs-tick">$10M</span>
          </div>
        </div>

        <!-- SLIDER VENTA â€” ancho completo, debajo -->
        <div class="slider-block full">
          <div class="slider-top">
            <span class="slider-title">ğŸ’° Rango Precio Venta</span>
            <span class="range-pill inactive green" id="ven-pill">Arrastra las manijas para filtrar</span>
          </div>
          <div class="drs-wrap" id="drs-ven">
            <div class="drs-track-bg"></div>
            <div class="drs-track-fill green-fill" id="ven-fill" style="left:0%;width:100%"></div>
            <input id="ven-lo" class="drs-input lo green-input" type="range" min="0" max="57" value="0" step="1">
            <input id="ven-hi" class="drs-input hi green-input" type="range" min="0" max="57" value="57" step="1">
          </div>
          <div class="drs-ticks">
            <span class="drs-tick">$150M</span>
            <span class="drs-tick">$1.000M</span>
            <span class="drs-tick">$2.000M</span>
            <span class="drs-tick">$3.000M</span>
          </div>
        </div>

      </div><!-- /fgrid -->

      <!-- PANEL SELECCIÃ“N -->
      <div class="seleccion-panel" id="seleccion-panel">
        <div class="seleccion-titulo">Lo que seleccionaste</div>
        <div class="seleccion-tags" id="seleccion-tags"></div>
      </div>

      <div class="btn-row">
        <button class="btn btn-primary"   onclick="buscar()">ğŸ” Buscar Propiedades</button>
        <button class="btn btn-secondary" onclick="mostrarTodo()">Ver todos</button>
        <button class="btn btn-danger"    onclick="limpiar()">âœ• Limpiar</button>
      </div>
    </div>
  </div>

  <div id="res"></div>
</div>

<footer>
  <div class="footer-logo">
    <svg width="20" height="20" viewBox="0 0 40 40" fill="none">
      <rect width="40" height="40" rx="10" fill="#2563eb"/>
      <polygon points="20,7 32,18 8,18" fill="white"/>
      <rect x="12" y="18" width="16" height="13" rx="1" fill="white" opacity="0.85"/>
      <rect x="17" y="24" width="6" height="7" rx="1.5" fill="#2563eb"/>
    </svg>
    <span class="footer-brand">Inmobiliaria House</span>
  </div>
  <div class="footer-sub">Solo propiedades disponibles Â· Portafolio en tiempo real</div>
</footer>

<div class="modal-overlay" id="modal-overlay" style="display:none" onclick="if(event.target===this)cerrarModal()">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title" id="modal-title">Detalle</div><div class="modal-subtitle" id="modal-subtitle"></div></div>
      <button class="modal-close" onclick="cerrarModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const APPS_SCRIPT='https://script.google.com/macros/s/AKfycbxFAgHSIQzD9dYVhKi9B4fKrrigISd5G17iiJHx6UhQf3_9e3t6p53R5vOrIcDOAF6Sng/exec';
const CSV_RAW='https://docs.google.com/spreadsheets/d/e/2PACX-1vRDLV71BFzFH90WHKcp9D0xxMu5SjeLNrHLlWoJxj74-SHEg7ZZlFORnKzOM1bgZCIsG6lF-iWOZltD/pub?gid=1657130181&single=true&output=csv';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABLAS DE PASOS
//  Arriendo: $0 â†’ $10.000.000, paso $500.000  (21 posiciones: 0â€“20)
//  Venta:    $150M â†’ $3.000M,   paso $50M     (58 posiciones: 0â€“57, pos 0 = 150M)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ARR_STEPS=[];
for(let v=0;v<=10000000;v+=500000)ARR_STEPS.push(v);
// ARR_STEPS[0]=0, ARR_STEPS[1]=500000 â€¦ ARR_STEPS[20]=10000000

const VEN_STEPS=[];
for(let v=150000000;v<=3000000000;v+=50000000)VEN_STEPS.push(v);
// VEN_STEPS[0]=150M â€¦ VEN_STEPS[57]=3000M

// Estado actual de cada slider (Ã­ndices)
let arrLo=0, arrHi=ARR_STEPS.length-1;   // por defecto: todo el rango
let venLo=0, venHi=VEN_STEPS.length-1;
let arrActive=false, venActive=false;     // true cuando el usuario mueve algÃºn thumb

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  FORMATEO
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmtArr(v){
  if(v===0)return '$0';
  if(v>=1000000)return'$'+(v/1000000).toFixed(1).replace(/\.0$/,'')+'M';
  return'$'+(v/1000)+'K';
}
function fmtVen(v){
  if(v>=1000000000)return'$'+(v/1000000000).toFixed(2).replace(/\.?0+$/,'')+'B';
  if(v>=1000000)return'$'+(v/1000000).toFixed(0)+'M';
  return'$'+v;
}
function pillaArr(){
  if(!arrActive)return'Sin filtro â€” arrastra para filtrar';
  const lo=ARR_STEPS[arrLo], hi=ARR_STEPS[arrHi];
  return'Entre '+fmtArr(lo)+' y '+fmtArr(hi);
}
function pillaVen(){
  if(!venActive)return'Sin filtro â€” arrastra para filtrar';
  const lo=VEN_STEPS[venLo], hi=VEN_STEPS[venHi];
  return'Entre '+fmtVen(lo)+' y '+fmtVen(hi);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  DUAL RANGE â€” implementaciÃ³n con inputs nativos superpuestos
//  MÃ¡s fiable en mÃ³vil y desktop, sin cÃ³digo de drag manual
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initDualRange(idLo, idHi, idFill, idPill, steps, isGreen, getLo, setLo, getHi, setHi, setActive, getActive, renderFn){
  const elLo  = document.getElementById(idLo);
  const elHi  = document.getElementById(idHi);
  const fill  = document.getElementById(idFill);
  const pill  = document.getElementById(idPill);
  const maxIdx = steps.length - 1;

  function updateFill(){
    const lo = getLo(), hi = getHi();
    const pLo = (lo / maxIdx) * 100;
    const pHi = (hi / maxIdx) * 100;
    fill.style.left  = pLo + '%';
    fill.style.width = (pHi - pLo) + '%';
    // Ajustar z-index: si lo estÃ¡ cerca del mÃ¡ximo, ponerlo encima para que sea agarrable
    if(lo >= maxIdx - 2){ elLo.style.zIndex=3; elHi.style.zIndex=2; }
    else { elLo.style.zIndex=1; elHi.style.zIndex=2; }
  }

  function updatePill(){
    const active = getActive();
    const lo = steps[getLo()], hi = steps[getHi()];
    if(isGreen){
      pill.className = 'range-pill green' + (active ? '' : ' inactive');
    } else {
      pill.className = 'range-pill' + (active ? '' : ' inactive');
    }
    pill.textContent = active
      ? 'Entre ' + (isGreen ? fmtVen(lo) : fmtArr(lo)) + ' y ' + (isGreen ? fmtVen(hi) : fmtArr(hi))
      : 'Arrastra las manijas para filtrar';
  }

  elLo.addEventListener('input', ()=>{
    let v = parseInt(elLo.value);
    if(v > getHi()) v = getHi();
    elLo.value = v;
    setLo(v);
    setActive(true);
    updateFill(); updatePill(); renderSeleccion();
  });
  elHi.addEventListener('input', ()=>{
    let v = parseInt(elHi.value);
    if(v < getLo()) v = getLo();
    elHi.value = v;
    setHi(v);
    setActive(true);
    updateFill(); updatePill(); renderSeleccion();
  });

  // Render inicial
  updateFill();
  updatePill();
}

function renderArr(){ /* Se maneja en initDualRange, este wrapper es para resetArr */ }
function renderVen(){ /* idem */ }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//  ESTADO FILTROS CHIPS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let D=[];
const F={neg:new Set(),ciu:new Set(),tipo:new Set()};
const LABELS={
  neg:{venta:'ğŸ’° Venta',arriendo:'ğŸ”‘ Arriendo',ambas:'ğŸ”„ Ambas modalidades'},
  ciu:{pereira:'ğŸ“ Pereira',dosquebradas:'ğŸ“ Dosquebradas','santa rosa':'ğŸ“ Santa Rosa',alcala:'ğŸ“ AlcalÃ¡',cerritos:'ğŸ“ Cerritos'},
  tipo:{apartamento:'ğŸ¢ Apartamento','aparta estudio':'ğŸ  Apartaestudio',casa:'ğŸ¡ Casa','casa campestre':'ğŸŒ¿ Campestre',finca:'ğŸŒ¾ Finca',local:'ğŸª Local',oficina:'ğŸ’¼ Oficina',bodega:'ğŸ­ Bodega',lote:'ğŸŒ³ Lote',penthouse:'ğŸ‘‘ Penthouse'}
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CARGA CSV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function iniciarCarga(){
  setStatus('load','Cargando datos...');
  document.getElementById('reload-btn').style.display='none';
  try{
    const r=await fetch(APPS_SCRIPT,{cache:'no-cache'});
    if(r.ok){const t=await r.text();if(t&&t.length>30&&t.includes(',')){ procesarCSV(t);return;}}
  }catch(e){}
  const proxies=[
    async()=>{const r=await fetch('https://corsproxy.io/?'+encodeURIComponent(CSV_RAW),{cache:'no-cache'});return r.ok?r.text():null;},
    async()=>{const r=await fetch('https://api.allorigins.win/get?url='+encodeURIComponent(CSV_RAW),{cache:'no-cache'});return r.ok?(await r.json()).contents:null;},
    async()=>{const r=await fetch(CSV_RAW,{cache:'no-cache'});return r.ok?r.text():null;},
  ];
  for(const p of proxies){try{const t=await p();if(t&&t.length>30){procesarCSV(t);return;}}catch(e){}}
  setStatus('err','âŒ Sin conexiÃ³n. Toca Actualizar.');
  document.getElementById('reload-btn').style.display='flex';
}
function procesarCSV(csv){
  try{
    const lines=csv.split('\n').filter(l=>l.trim().length>2);
    if(lines.length<2)throw new Error('CSV vacÃ­o');
    const hdrs=parseCSVLine(lines[0]).map(h=>h.toLowerCase().trim().replace(/\s+/g,' ').replace(/\r/g,''));
    D=[];
    for(let i=1;i<lines.length;i++){
      const vals=parseCSVLine(lines[i]);if(vals.length<3)continue;
      const obj={};hdrs.forEach((h,j)=>{obj[h]=(vals[j]||'').trim().replace(/\r/g,'');});
      const eKey=hdrs.find(h=>h.includes('estado'));
      const eVal=eKey?(obj[eKey]||'').toUpperCase():'';
      if(eVal&&!eVal.includes('DISPONIBLE'))continue;
      if(Object.values(obj).some(v=>v.length>0))D.push(obj);
    }
    if(!D.length)throw new Error('Sin propiedades disponibles');
    const vs=D.filter(p=>eV(p)&&!eA2(p)).length;
    const as=D.filter(p=>eA(p)&&!eA2(p)).length;
    const bs=D.filter(p=>eA2(p)).length;
    anim('hs1',D.length);anim('hs2',vs);anim('hs3',as);anim('hs4',bs);
    setStatus('ok','âœ… '+D.length+' propiedades disponibles');
    document.getElementById('status-time').textContent='Actualizado '+new Date().toLocaleTimeString('es-CO',{hour:'2-digit',minute:'2-digit'});
    document.getElementById('reload-btn').style.display='flex';
  }catch(e){setStatus('err','Error: '+e.message);document.getElementById('reload-btn').style.display='flex';}
}
function setStatus(t,m){const el=document.getElementById('status-badge');el.className='sbadge '+(t==='ok'?'sb-ok':t==='err'?'sb-err':'sb-load');el.innerHTML=t==='load'?'<em class="sb-spin">âŸ³</em> '+m:m;}
function anim(id,target){const el=document.getElementById(id);let cur=0;const step=Math.max(1,Math.ceil(target/25));const iv=setInterval(()=>{cur=Math.min(cur+step,target);el.textContent=cur;if(cur>=target)clearInterval(iv);},45);}
function parseCSVLine(line){const r=[];let cur='';let inQ=false;for(let i=0;i<line.length;i++){const c=line[i];if(c==='"'){inQ=!inQ;continue;}if(c===','&&!inQ){r.push(cur.trim());cur='';continue;}cur+=c;}r.push(cur.trim());return r;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const JUNK=['n/a','no aplica','no tiene','sin informacion','sin informaciÃ³n','notiene','no dice','pendiente','sin contacto','sin informaci'];
function get(obj,...keys){for(const k of keys)for(const h of Object.keys(obj)){if(h.toLowerCase().includes(k.toLowerCase())){const v=(obj[h]||'').trim();if(v&&!JUNK.some(j=>v.toLowerCase().startsWith(j)))return v;}}return'';}
function negocio(p){return(get(p,'tipo de negociaci','negociaci')||'').toLowerCase();}
function ciudad(p){return(get(p,'ubicaci','ciudad')||'').toLowerCase();}
function tipo(p){return(get(p,'tipo de inmueble','tipo')||'').toLowerCase();}
function eV(p){return negocio(p).includes('venta');}
function eA(p){const n=negocio(p);return n.includes('arriendo')||n.includes('renta');}
function eA2(p){return eV(p)&&eA(p);}
function num(v){
  if(!v)return 0;
  let s=String(v).trim();
  if(s.includes(',')&&s.includes('.')){s=s.replace(/\./g,'').replace(',','.');}
  else if(s.includes('.')&&!s.includes(',')){const parts=s.split('.');if(parts.length>1&&parts[parts.length-1].length===3)s=s.replace(/\./g,'');}
  else if(s.includes(',')&&!s.includes('.')){s=s.replace(/,/g,'');}
  s=s.replace(/[^\d.]/g,'');
  const n=parseFloat(s);return isNaN(n)?0:Math.round(n);
}
function pVenta(p){return num(get(p,'precio de venta','precio venta'));}
function pArriendo(p){return num(get(p,'precio de arriendo','precio arriendo','canon'));}
function pAdmon(p){return num(get(p,'administraci','admon','valor admin'));}
// Formato display
function fmt(n){if(!n||n<=0)return null;if(n>=1000000000)return'$'+(n/1000000000).toFixed(2).replace(/\.?0+$/,'')+'B';if(n>=1000000)return'$'+(n/1000000).toFixed(0)+'M';return'$'+n.toLocaleString('es-CO');}
function fmtA(n){if(!n||n<=0)return null;return'$'+Math.round(n).toLocaleString('es-CO');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHIPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggle(el){
  const g=el.dataset.g,v=el.dataset.v,col=el.dataset.col||'col-blue';
  if(F[g].has(v)){F[g].delete(v);el.classList.remove('active','col-green','col-gold','col-purple','col-blue');}
  else{F[g].add(v);el.classList.remove('col-green','col-gold','col-purple','col-blue');el.classList.add('active',col);}
  renderSeleccion();
}
function renderSeleccion(){
  let h='',total=0;
  for(const[g,s]of Object.entries(F))for(const v of s){
    total++;const l=LABELS[g]?.[v]||v;
    h+='<span class="stag">'+l+'<span class="x" onclick="quitarFiltro(\''+g+'\',\''+v+'\')">âœ•</span></span>';
  }
  if(arrActive){
    total++;
    h+='<span class="stag">ğŸ”‘ '+fmtArr(ARR_STEPS[arrLo])+' â€“ '+fmtArr(ARR_STEPS[arrHi])+'<span class="x" onclick="resetArr()">âœ•</span></span>';
  }
  if(venActive){
    total++;
    h+='<span class="stag">ğŸ’° '+fmtVen(VEN_STEPS[venLo])+' â€“ '+fmtVen(VEN_STEPS[venHi])+'<span class="x" onclick="resetVen()">âœ•</span></span>';
  }
  document.getElementById('seleccion-tags').innerHTML=h;
  document.getElementById('seleccion-panel').classList.toggle('visible',total>0);
}
function quitarFiltro(g,v){
  F[g].delete(v);
  const chip=document.querySelector('.chip[data-g="'+g+'"][data-v="'+v+'"]');
  if(chip)chip.classList.remove('active','col-green','col-gold','col-purple','col-blue');
  renderSeleccion();
}
function resetArr(){
  arrActive=false;arrLo=0;arrHi=ARR_STEPS.length-1;
  document.getElementById('arr-lo').value=0;
  document.getElementById('arr-hi').value=ARR_STEPS.length-1;
  document.getElementById('arr-fill').style.left='0%';
  document.getElementById('arr-fill').style.width='100%';
  const pill=document.getElementById('arr-pill');
  pill.textContent='Arrastra las manijas para filtrar';
  pill.className='range-pill inactive';
  renderSeleccion();
}
function resetVen(){
  venActive=false;venLo=0;venHi=VEN_STEPS.length-1;
  document.getElementById('ven-lo').value=0;
  document.getElementById('ven-hi').value=VEN_STEPS.length-1;
  document.getElementById('ven-fill').style.left='0%';
  document.getElementById('ven-fill').style.width='100%';
  const pill=document.getElementById('ven-pill');
  pill.textContent='Arrastra las manijas para filtrar';
  pill.className='range-pill green inactive';
  renderSeleccion();
}
function limpiar(){
  for(const g of Object.keys(F))F[g].clear();
  document.querySelectorAll('.chip').forEach(el=>el.classList.remove('active','col-green','col-gold','col-purple','col-blue'));
  document.getElementById('q').value='';
  resetArr();resetVen();
  renderSeleccion();
  document.getElementById('res').innerHTML='';
}
function mostrarTodo(){limpiar();if(!D.length){document.getElementById('res').innerHTML='<div class="empty"><span class="empty-ico">ğŸ“¡</span><h3>Cargando...</h3><p>Espera</p></div>';return;}render(D,'',false,false);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUSCAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buscar(){
  const res=document.getElementById('res');
  const qv=(document.getElementById('q').value||'').trim().toLowerCase();
  if(!D.length){res.innerHTML='<div class="empty"><span class="empty-ico">ğŸ“‹</span><h3>Sin datos</h3><p>Espera que carguen las propiedades</p></div>';return;}
  const hayFiltros=Object.values(F).some(s=>s.size>0)||qv.length>0||arrActive||venActive;
  if(!hayFiltros){render(D,'',false,false);return;}
  res.innerHTML='<div class="loader"><div class="ldots"><div class="ldot"></div><div class="ldot"></div><div class="ldot"></div></div><p style="color:var(--g500);font-size:13.5px">Buscando...</p></div>';
  setTimeout(()=>{
    let lista=D.filter(p=>filtrar(p,qv));
    const esArr=F.neg.has('arriendo')||arrActive;
    const esVen=F.neg.has('venta')||venActive;
    const hayPrecio=F.neg.size>0||arrActive||venActive;
    if(hayPrecio){lista.sort((a,b)=>{
      const pa=esArr&&!esVen?(pArriendo(a)||pVenta(a)):(pVenta(a)||pArriendo(a));
      const pb=esArr&&!esVen?(pArriendo(b)||pVenta(b)):(pVenta(b)||pArriendo(b));
      return pb-pa;
    });}
    render(lista,qv,hayPrecio,esArr&&!esVen);
  },150);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NORMALIZAR â€” quita tildes y pasa a minÃºsculas
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function norm(s){
  return (s||'').toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^a-z0-9\s]/g,' ')
    .replace(/\s+/g,' ').trim();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABLA DE SINÃ“NIMOS
//  Cada entrada: [ palabraClave, [...variantes] ]
//  Si el usuario escribe cualquier variante â†’ se buscan todas
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SINONIMOS = [
  // Tipos de inmueble
  [['apto','apartamento','apt'],            ['apartamento','apto']],
  [['apartaestudio','aptoestudio','estudio'],['apartaestudio','aparta estudio','estudio']],
  [['casa'],                                 ['casa']],
  [['campestre','finca campestre'],          ['campestre']],
  [['finca'],                                ['finca']],
  [['local','comercial'],                    ['local']],
  [['oficina'],                              ['oficina']],
  [['bodega'],                               ['bodega']],
  [['lote','terreno'],                       ['lote','terreno']],
  [['penthouse','ph'],                       ['penthouse']],
  // NegociaciÃ³n
  [['venta','vender'],                       ['venta']],
  [['arriendo','arrendamiento','alquiler','rentar','renta'], ['arriendo','renta']],
  // Habitaciones (el usuario puede escribir "3 hab", "3 habitaciones", "3 cuartos")
  [['hab','habitacion','habitaciones','cuarto','cuartos','alcoba','alcobas'],
                                             ['habitacion','hab','cuarto','alcoba']],
  // BaÃ±os
  [['bano','banos','bathroom'],             ['bano','banos']],
  // Parqueadero
  [['parqueadero','parking','garaje','garage'], ['parqueadero','garaje','parking']],
  // Ãreas comunes
  [['piscina'],                              ['piscina']],
  [['gimnasio','gym'],                       ['gimnasio','gym']],
  [['conjunto','urbanizacion','unidad'],     ['conjunto','urbanizacion']],
  [['vigilancia','porteria','seguridad'],    ['vigilancia','porteria','seguridad']],
  // Ciudades / sectores
  [['pereira'],                              ['pereira']],
  [['dosquebradas','dosqbradas'],            ['dosquebradas']],
  [['santa rosa','santarosa'],               ['santa rosa']],
  [['cerritos'],                             ['cerritos']],
  [['alcala'],                               ['alcala']],
  [['cuba'],                                 ['cuba']],
  [['pinares'],                              ['pinares']],
  [['combia'],                               ['combia']],
  [['condina'],                              ['condina']],
  [['belmonte'],                             ['belmonte']],
  [['circunvalar'],                          ['circunvalar']],
  [['berlin'],                               ['berlin']],
  // Estratos
  [['estrato'],                              ['estrato']],
  // Piso
  [['piso'],                                 ['piso']],
];

// Expande una palabra del usuario a sus variantes de bÃºsqueda
function expandir(palabra){
  const p = norm(palabra);
  for(const [claves, variantes] of SINONIMOS){
    if(claves.some(c => p === c || p.includes(c) || c.includes(p))){
      return variantes.map(v => norm(v));
    }
  }
  return [p]; // sin sinÃ³nimo: buscar literal
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONSTRUIR TEXTO BÃšSQUEDA de una propiedad
//  Incluye TODOS los campos relevantes, normalizados
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function textoBusqueda(p){
  const campos = [];
  // Recorrer TODOS los campos del objeto
  Object.values(p).forEach(v => { if(v) campos.push(norm(v)); });
  // AÃ±adir campos calculados especiales
  campos.push(norm(negocio(p)));
  campos.push(norm(ciudad(p)));
  campos.push(norm(tipo(p)));
  // Precio como texto para bÃºsquedas tipo "2 millones"
  const pa = pArriendo(p), pv = pVenta(p);
  if(pa>0) campos.push(String(pa));
  if(pv>0) campos.push(String(pv));
  return campos.join(' ');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FILTRAR â€” motor completo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filtrar(p, qv){
  const neg = negocio(p), ciu = ciudad(p), tip = tipo(p);
  const dir = norm(get(p,'direccion','direcciÃ³n'));
  const pv  = pVenta(p), pa  = pArriendo(p);

  // â”€â”€ CHIPS: NegociaciÃ³n â”€â”€
  if(F.neg.size > 0){
    let ok = false;
    if(F.neg.has('venta')   && eV(p))  ok = true;
    if(F.neg.has('arriendo')&& eA(p))  ok = true;
    if(F.neg.has('ambas')   && eA2(p)) ok = true;
    if(!ok) return false;
  }
  // â”€â”€ CHIPS: Ciudad â”€â”€
  if(F.ciu.size > 0){
    let ok = false;
    for(const c of F.ciu) if(ciu.includes(c) || dir.includes(c)) ok = true;
    if(!ok) return false;
  }
  // â”€â”€ CHIPS: Tipo â”€â”€
  if(F.tipo.size > 0){
    let ok = false;
    for(const tv of F.tipo){
      if(tv==='aparta estudio' && tip.includes('aparta') && (tip.includes('estudio')||tip.includes('studio'))) ok=true;
      else if(tv==='casa campestre' && tip.includes('campestre')) ok=true;
      else if(tv==='casa' && tip.includes('casa') && !tip.includes('campestre')) ok=true;
      else if(!['casa campestre','aparta estudio','casa'].includes(tv) && tip.includes(tv)) ok=true;
    }
    if(!ok) return false;
  }
  // â”€â”€ SLIDERS â”€â”€
  if(arrActive){ const mn=ARR_STEPS[arrLo],mx=ARR_STEPS[arrHi]; if(pa<=0||pa<mn||pa>mx) return false; }
  if(venActive){ const mn=VEN_STEPS[venLo],mx=VEN_STEPS[venHi]; if(pv<=0||pv<mn||pv>mx) return false; }

  // â”€â”€ BÃšSQUEDA LIBRE â”€â”€
  if(qv && qv.trim().length >= 1){
    const tb = textoBusqueda(p);

    // Dividir la consulta en tokens (incluye dÃ­gitos solos)
    const tokens = norm(qv).split(/\s+/).filter(w => w.length >= 1);
    if(tokens.length === 0) return true;

    let encontrados = 0;
    for(const token of tokens){
      const variantes = expandir(token);
      // Un token se considera encontrado si ALGUNA de sus variantes aparece en el texto
      const match = variantes.some(v => tb.includes(v));
      if(match) encontrados++;
    }

    // Umbral: con 1-2 tokens exigir 100%; con 3+ tokens tolerar que falte 1
    const umbral = tokens.length <= 2 ? tokens.length : tokens.length - 1;
    if(encontrados < umbral) return false;
  }

  return true;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function abrirModal(idx){
  const p=D[idx];if(!p)return;
  const tip=get(p,'tipo de inmueble','tipo')||'Inmueble';
  const ciu=get(p,'ubicaci','ciudad')||'';
  const dir=get(p,'direccion','direcciÃ³n')||'';
  document.getElementById('modal-title').textContent=tip;
  document.getElementById('modal-subtitle').textContent=(ciu?'ğŸ“ '+ciu:'')+(dir?' Â· '+dir:'');
  const pv=pVenta(p),pa=pArriendo(p),admon=pAdmon(p);
  let body='';
  if(pv>0||pa>0){
    body+='<div class="modal-section"><div class="modal-sec-title">ğŸ’° Precios</div><div class="modal-grid">';
    if(pv>0)body+='<div class="modal-field hl-blue"><div class="modal-field-label">Precio de Venta</div><div class="modal-field-value">'+fmt(pv)+'</div></div>';
    if(pa>0)body+='<div class="modal-field hl-green"><div class="modal-field-label">Canon de Arriendo</div><div class="modal-field-value">'+fmtA(pa)+'/mes</div></div>';
    if(admon>0)body+='<div class="modal-field"><div class="modal-field-label">AdministraciÃ³n</div><div class="modal-field-value">'+fmtA(admon)+'/mes</div></div>';
    body+='</div></div>';
  }
  const sf=[['tipo de inmueble','tipo','Tipo'],['ubicaci','ciudad','Ciudad'],['direccion','direcciÃ³n','DirecciÃ³n'],['habitaciones','habitaciones','Habitaciones'],['baÃ±os','banos','BaÃ±os'],['area construida','Ã¡rea construida','Ãrea (mÂ²)'],['area total','Ã¡rea total','Ãrea Total (mÂ²)'],['estrato','estrato','Estrato'],['antigÃ¼edad','antiguedad','AntigÃ¼edad'],['piso','piso','Piso'],['parqueaderos','parqueadero','Parqueaderos'],['conjunto','barrio','Conjunto / Barrio'],['tipo de negociaci','negociaci','NegociaciÃ³n']];
  let sH='';sf.forEach(([k1,k2,label])=>{const v=get(p,k1,k2);if(v)sH+='<div class="modal-field"><div class="modal-field-label">'+label+'</div><div class="modal-field-value">'+v+'</div></div>';});
  if(sH)body+='<div class="modal-section"><div class="modal-sec-title">ğŸ  CaracterÃ­sticas</div><div class="modal-grid">'+sH+'</div></div>';
  const asesor=get(p,'asesor responsable','asesor'),tel=get(p,'telefono','celular','contacto'),email=get(p,'email','correo','mail'),cod=get(p,'codigo','metrocuadrado','cod');
  let cH='';
  if(asesor)cH+='<div class="modal-field full"><div class="modal-field-label">Asesor</div><div class="modal-field-value">ğŸ‘¤ '+asesor+'</div></div>';
  if(tel)cH+='<div class="modal-field"><div class="modal-field-label">TelÃ©fono</div><div class="modal-field-value">ğŸ“ '+tel+'</div></div>';
  if(email)cH+='<div class="modal-field"><div class="modal-field-label">Email</div><div class="modal-field-value">âœ‰ï¸ '+email+'</div></div>';
  if(cod)cH+='<div class="modal-field"><div class="modal-field-label">CÃ³digo</div><div class="modal-field-value">'+cod+'</div></div>';
  if(cH)body+='<div class="modal-section"><div class="modal-sec-title">ğŸ‘¤ Contacto</div><div class="modal-grid">'+cH+'</div></div>';
  const obs=get(p,'observaciones','observacion');
  if(obs&&obs.length>3)body+='<div class="modal-section"><div class="modal-sec-title">ğŸ“ Observaciones</div><div class="modal-obs">'+obs+'</div></div>';
  const yaUsados=['tipo de inmueble','tipo','ubicaci','ciudad','direccion','direcciÃ³n','habitaciones','baÃ±os','banos','area','estrato','antigÃ¼edad','antiguedad','piso','parqueadero','conjunto','barrio','negociaci','asesor','telefono','celular','email','correo','mail','codigo','metrocuadrado','precio','arriendo','canon','administraci','observaci','estado'];
  let oH='';
  Object.keys(p).forEach(h=>{
    if(yaUsados.some(k=>h.includes(k)))return;
    const v=(p[h]||'').trim();if(!v||JUNK.some(j=>v.toLowerCase().startsWith(j)))return;
    oH+='<div class="modal-field"><div class="modal-field-label">'+h.replace(/_/g,' ').replace(/\b\w/g,l=>l.toUpperCase())+'</div><div class="modal-field-value">'+v+'</div></div>';
  });
  if(oH)body+='<div class="modal-section"><div class="modal-sec-title">ğŸ“‹ Adicional</div><div class="modal-grid">'+oH+'</div></div>';
  document.getElementById('modal-body').innerHTML=body||'<p style="color:var(--g400);font-size:13px">Sin informaciÃ³n adicional.</p>';
  document.getElementById('modal-overlay').style.display='flex';
  document.body.style.overflow='hidden';
}
function cerrarModal(){document.getElementById('modal-overlay').style.display='none';document.body.style.overflow='';}
document.addEventListener('keydown',e=>{if(e.key==='Escape')cerrarModal();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDER TARJETAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getEmoji(t){t=(t||'').toLowerCase();if(t.includes('penthouse'))return'ğŸ‘‘';if(t.includes('campestre'))return'ğŸŒ¿';if(t.includes('finca'))return'ğŸŒ¾';if(t.includes('estudio'))return'ğŸ ';if(t.includes('apto')||t.includes('apartamento'))return'ğŸ¢';if(t.includes('casa'))return'ğŸ¡';if(t.includes('local'))return'ğŸª';if(t.includes('oficina'))return'ğŸ’¼';if(t.includes('lote')||t.includes('terreno'))return'ğŸŒ³';if(t.includes('bodega'))return'ğŸ­';return'ğŸ ';}

function render(lista,qv,hayPrecio,esArr){
  const res=document.getElementById('res');
  if(!lista.length){res.innerHTML='<div class="empty"><span class="empty-ico">ğŸ”</span><h3>Sin resultados</h3><p>No encontramos propiedades con esos criterios.</p></div>';return;}
  let h='<div class="rhead"><div class="rcount">ğŸ¯ <b>'+lista.length+'</b> '+(lista.length===1?'propiedad disponible':'propiedades disponibles')+'</div>'+(hayPrecio?'<div class="rsort">ğŸ“Š Mayor â†’ menor precio</div>':'')+'</div><div class="pgrid">';
  lista.slice(0,80).forEach((p,i)=>{
    const idx=D.indexOf(p);
    const tip=get(p,'tipo de inmueble','tipo')||'Inmueble';
    const ciu=get(p,'ubicaci','ciudad')||'Sin ciudad';
    const dir=get(p,'direccion','direcciÃ³n')||'';
    const cod=get(p,'codigo','metrocuadrado')||'';
    const asesor=get(p,'asesor responsable','asesor')||'';
    const pv=pVenta(p),pa=pArriendo(p),admon=pAdmon(p);
    const area=get(p,'area construida','Ã¡rea construida','Ã¡rea','area')||'';
    const hab=get(p,'habitaciones')||'';
    const ban=get(p,'baÃ±os','banos')||'';
    const est=get(p,'estrato')||'';
    const ambas=eA2(p),soloV=eV(p)&&!ambas,soloA=eA(p)&&!ambas;
    const headCls=ambas?'tb':soloV?'tv':'ta';
    let mods='';
    if(soloV||ambas)mods+='<span class="mbadge mbv">ğŸ’° Venta</span>';
    if(soloA||ambas)mods+='<span class="mbadge mba">ğŸ”‘ Arriendo</span>';
    mods+='<span class="mbadge mbok">âœ… Disponible</span>';
    let pH='<div class="pblock">';
    if(pv>0){pH+='<div class="pventa">'+fmt(pv)+' <small>venta</small></div>';if(esArr&&pa>0)pH+='<div class="cross-tag cross-a">ğŸ”‘ Arriendo: '+fmtA(pa)+'/mes</div>';}
    if(pa>0){pH+='<div class="parriendo">'+fmtA(pa)+' <small>/mes arriendo</small></div>';if(!esArr&&pv>0&&!soloA)pH+='<div class="cross-tag cross-v">ğŸ’° Venta: '+fmt(pv)+'</div>';}
    if(!pv&&!pa)pH+='<div style="font-size:12.5px;color:var(--g400)">Precio a consultar</div>';
    if(admon>0)pH+='<div class="admon">ğŸ¢ Admon: '+fmtA(admon)+'/mes</div>';
    pH+='</div>';
    const dualH=ambas?'<div class="dalert">âš ï¸ <strong>Doble modalidad</strong> Â· Venta: '+(pv>0?fmt(pv):'consultar')+' Â· Arriendo: '+(pa>0?fmtA(pa)+'/mes':'consultar')+'</div>':'';
    const specs=[hab&&hab!='0'?'<span class="spec">ğŸ›ï¸ '+hab+'</span>':'',ban&&ban!='0'?'<span class="spec">ğŸš¿ '+ban+'</span>':'',area?'<span class="spec">ğŸ“ '+area+' mÂ²</span>':'',est&&est!='SIN INFORMACION'?'<span class="spec">Est.'+est+'</span>':''].filter(Boolean).join('');
    const asesorH=asesor?'<div class="asesor">ğŸ‘¤ <strong>'+asesor+'</strong></div>':'';
    h+='<div class="pc" style="animation-delay:'+Math.min(i*0.04,1.2)+'s">'
      +'<div class="pctop '+headCls+'">'+(cod?'<span class="pc-cod">'+cod+'</span>':'')
      +'<div class="pc-emoji">'+getEmoji(tip)+'</div><div class="pctop-type">'+tip+'</div>'
      +'<div class="pc-city-main">'+ciu+'</div>'+(dir?'<div class="pc-city-sub">'+dir+'</div>':'')
      +'</div><div class="pcbody"><div class="mods">'+mods+'</div>'+pH
      +(specs?'<div class="specs">'+specs+'</div>':'')+dualH+asesorH
      +'<button class="ver-mas-btn" onclick="abrirModal('+idx+')">Ver informaciÃ³n completa â†’</button>'
      +'</div></div>';
  });
  h+='</div>';
  if(lista.length>80)h+='<p style="text-align:center;color:var(--g400);margin-top:14px;font-size:12.5px">Mostrando 80 de '+lista.length+'. Ajusta los filtros.</p>';
  res.innerHTML=h;
  setTimeout(()=>res.scrollIntoView({behavior:'smooth',block:'start'}),100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ARRANQUE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('DOMContentLoaded',()=>{
  // â”€â”€ INIT DUAL RANGE SLIDERS â”€â”€
  initDualRange(
    'arr-lo','arr-hi','arr-fill','arr-pill',
    ARR_STEPS, false,
    ()=>arrLo, v=>{ arrLo=v; },
    ()=>arrHi, v=>{ arrHi=v; },
    v=>{ arrActive=v; }, ()=>arrActive,
  );
  initDualRange(
    'ven-lo','ven-hi','ven-fill','ven-pill',
    VEN_STEPS, true,
    ()=>venLo, v=>{ venLo=v; },
    ()=>venHi, v=>{ venHi=v; },
    v=>{ venActive=v; }, ()=>venActive,
  );

  iniciarCarga();
});
</script>
</body>
</html>
