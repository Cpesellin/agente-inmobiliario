<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asistente Inmobiliario Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Space+Mono&display=swap" rel="stylesheet">
<style>
:root{
  --p:#2563eb;--pl:#3b82f6;--g:#059669;--r:#dc2626;--o:#d97706;
  --bg:#f0f4ff;--surface:#fff;--text:#1e293b;--muted:#64748b;
  --shadow:0 4px 24px rgba(37,99,235,0.10);--radius:18px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:var(--bg);min-height:100vh;color:var(--text)}

/* HERO */
.hero{background:linear-gradient(135deg,#1e3a8a 0%,#2563eb 50%,#7c3aed 100%);padding:40px 24px 60px;text-align:center;position:relative;overflow:hidden}
.hero::before{content:'üè†';position:absolute;font-size:300px;opacity:0.04;top:-60px;left:50%;transform:translateX(-50%)}
.hero h1{font-size:clamp(28px,5vw,48px);font-weight:800;color:#fff;letter-spacing:-1px;margin-bottom:10px;position:relative}
.hero p{font-size:16px;color:rgba(255,255,255,0.85);font-weight:300;position:relative}
.hero-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);border-radius:20px;padding:6px 16px;font-size:13px;color:rgba(255,255,255,0.9);margin-bottom:20px;backdrop-filter:blur(10px)}

/* MAIN */
.main{max-width:1100px;margin:-30px auto 40px;padding:0 20px}

/* CARD */
.card{background:var(--surface);border-radius:var(--radius);padding:28px;margin-bottom:20px;box-shadow:var(--shadow);border:1px solid rgba(37,99,235,0.08);transition:box-shadow 0.2s}
.card:hover{box-shadow:0 8px 32px rgba(37,99,235,0.15)}
.card-head{display:flex;align-items:center;gap:12px;margin-bottom:6px}
.card-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.ci-blue{background:rgba(37,99,235,0.1)}
.ci-green{background:rgba(5,150,105,0.1)}
.card-title{font-size:18px;font-weight:700;color:var(--p)}
.card-sub{font-size:13px;color:var(--muted);margin-bottom:20px;padding-left:56px;margin-top:-2px}

/* TEXTAREA & INPUT */
textarea{width:100%;min-height:160px;padding:16px;border:2px solid #e2e8f0;border-radius:12px;background:#f8fafc;font-family:'Space Mono',monospace;font-size:12px;color:var(--text);resize:vertical;transition:all 0.2s;line-height:1.5}
textarea:focus{outline:none;border-color:var(--p);background:#fff;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
.input-wrap{position:relative}
.search-input{width:100%;padding:16px 60px 16px 50px;border:2px solid #e2e8f0;border-radius:14px;background:#f8fafc;font-size:15px;font-family:'Poppins',sans-serif;color:var(--text);transition:all 0.2s}
.search-input:focus{outline:none;border-color:var(--p);background:#fff;box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
.search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-size:20px;pointer-events:none}
.search-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:var(--p);border:none;border-radius:10px;width:42px;height:42px;font-size:20px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center}
.search-btn:hover{background:var(--pl);transform:translateY(-50%) scale(1.05)}

/* BUTTON */
.btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,var(--p),var(--pl));color:#fff;font-size:15px;font-weight:600;font-family:'Poppins',sans-serif;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 12px rgba(37,99,235,0.3);margin-top:12px;display:flex;align-items:center;justify-content:center;gap:8px}
.btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(37,99,235,0.4)}

/* STATUS */
.toast{display:inline-flex;align-items:center;gap:8px;padding:10px 16px;border-radius:10px;font-size:13px;font-weight:500;margin-top:12px}
.toast.ok{background:#d1fae5;color:#065f46;border:1.5px solid #6ee7b7}
.toast.err{background:#fee2e2;color:#991b1b;border:1.5px solid #fca5a5}

/* CHIPS */
.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:14px}
.chip{background:#eff6ff;border:1.5px solid #bfdbfe;color:var(--p);border-radius:20px;padding:6px 14px;font-size:12px;font-weight:500;cursor:pointer;transition:all 0.2s;white-space:nowrap}
.chip:hover{background:var(--p);color:#fff;border-color:var(--p);transform:translateY(-2px)}

/* INFO */
.info{background:#eff6ff;border:1.5px solid #bfdbfe;border-radius:12px;padding:14px 16px;font-size:13px;color:#1e40af;line-height:1.7;margin-top:14px}
.info strong{color:var(--p)}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.stat{background:var(--surface);border-radius:14px;padding:16px;text-align:center;box-shadow:var(--shadow);border:1px solid rgba(37,99,235,0.08)}
.stat-num{font-size:28px;font-weight:800;color:var(--p)}
.stat-label{font-size:11px;color:var(--muted);margin-top:2px}

/* RESULTS */
.results-bar{background:var(--surface);border-radius:14px;padding:16px 20px;margin-bottom:16px;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:space-between;flex-wrap:gap}
.results-title{font-size:18px;font-weight:700;color:var(--text)}
.results-title b{color:var(--g)}

/* GRID */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:20px}

/* PROPERTY CARD */
.pc{background:var(--surface);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:all 0.25s;border:1px solid transparent;animation:up 0.4s ease both}
@keyframes up{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.pc:hover{transform:translateY(-6px);box-shadow:0 12px 40px rgba(37,99,235,0.18);border-color:var(--p)}

.pc-head{padding:18px 20px;position:relative;overflow:hidden}
.pc-head.h-venta{background:linear-gradient(135deg,#1e40af,#3b82f6)}
.pc-head.h-arriendo{background:linear-gradient(135deg,#065f46,#10b981)}
.pc-head.h-ambas{background:linear-gradient(135deg,#7c2d12,#f97316)}
.pc-head::after{content:'';position:absolute;bottom:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,0.08)}
.pc-emoji{font-size:30px;margin-bottom:6px;position:relative;z-index:1}
.pc-tipo{font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,0.75);margin-bottom:4px;position:relative;z-index:1}
.pc-dir{font-size:14px;font-weight:600;color:#fff;position:relative;z-index:1;line-height:1.3}
.pc-ciudad{font-size:12px;color:rgba(255,255,255,0.8);margin-top:4px;position:relative;z-index:1}
.pc-codigo{position:absolute;top:12px;right:14px;font-size:10px;background:rgba(0,0,0,0.25);color:#fff;padding:3px 8px;border-radius:8px;font-family:'Space Mono',monospace;z-index:1}

.pc-body{padding:16px 20px}
.badges-row{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.badge{padding:4px 10px;border-radius:8px;font-size:11px;font-weight:600;display:inline-flex;align-items:center;gap:4px}
.bv{background:#dbeafe;color:#1d4ed8}
.ba{background:#d1fae5;color:#065f46}
.bb{background:#ffedd5;color:#9a3412}
.be{background:#f1f5f9;color:var(--muted)}

.price-main{font-size:24px;font-weight:800;color:var(--p);margin:8px 0 2px;line-height:1}
.price-main small{font-size:13px;font-weight:400;color:var(--muted)}
.price-rent{font-size:15px;font-weight:600;color:var(--g);margin-bottom:8px}

.specs-row{display:flex;flex-wrap:wrap;gap:8px;padding-top:12px;border-top:1.5px solid #f1f5f9;margin-top:8px}
.spec{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:4px;background:#f8fafc;padding:4px 10px;border-radius:8px}

.dual-alert{background:#fff7ed;border:1.5px solid #fed7aa;border-radius:10px;padding:10px 14px;font-size:12px;color:#9a3412;margin-top:10px;line-height:1.5;display:flex;gap:8px;align-items:flex-start}

.obs{background:#f8fafc;border-radius:8px;padding:8px 12px;font-size:11px;color:var(--muted);margin-top:8px;line-height:1.5;font-style:italic;border-left:3px solid #e2e8f0}

.asesor-row{font-size:12px;color:var(--muted);margin-top:8px;display:flex;align-items:center;gap:6px}

/* NO RESULTS */
.empty{background:var(--surface);border-radius:var(--radius);padding:60px 20px;text-align:center;box-shadow:var(--shadow)}
.empty-emoji{font-size:64px;margin-bottom:16px}
.empty h3{font-size:22px;font-weight:700;margin-bottom:8px}
.empty p{color:var(--muted)}

/* LOADER */
.loader{text-align:center;padding:40px}
.dots{display:inline-flex;gap:8px}
.d{width:12px;height:12px;border-radius:50%;background:var(--p);animation:blink 1.4s infinite ease-in-out}
.d:nth-child(1){animation-delay:-0.32s}
.d:nth-child(2){animation-delay:-0.16s}
@keyframes blink{0%,80%,100%{transform:scale(0.7);opacity:0.4}40%{transform:scale(1.1);opacity:1}}

@media(max-width:640px){.hero{padding:30px 16px 50px}.main{padding:0 12px}.card{padding:20px}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<div class="hero">
  <div class="hero-badge">üè† Asistente Inmobiliario Inteligente</div>
  <h1>Encuentra el Predio Perfecto</h1>
  <p>Consultas en tiempo real ¬∑ Base de datos actualizada ¬∑ 100% confiable</p>
</div>

<div class="main">

<!-- PASO 1 -->
<div class="card">
  <div class="card-head">
    <div class="card-icon ci-blue">üìã</div>
    <div class="card-title">Paso 1: Cargar Base de Datos</div>
  </div>
  <div class="card-sub">Descarga el Google Sheets como CSV ‚Üí Abre con Bloc de Notas ‚Üí Ctrl+A ‚Üí Ctrl+C ‚Üí Pega aqu√≠</div>
  
  <textarea id="csv" placeholder="Pega aqu√≠ el CSV completo...

Deber√≠a comenzar as√≠:
Marca temporal,Estado actual,Asesor responsable,Tipo de Inmueble, Tipo de Negociaci√≥n,...
10/02/2026,DISPONIBLE,KATHERINE,APARTAMENTO,[ ] VENTA,..."></textarea>
  
  <button class="btn" onclick="cargar()">‚úÖ Cargar Base de Datos</button>
  <div id="st"></div>
  
  <div class="info">
    üí° <strong>C√≥mo obtener el CSV:</strong> Google Sheets ‚Üí <strong>Archivo</strong> ‚Üí <strong>Descargar</strong> ‚Üí <strong>Valores separados por comas (.csv)</strong> ‚Üí Abre con Bloc de Notas ‚Üí Selecciona todo (Ctrl+A) ‚Üí Copia (Ctrl+C) ‚Üí Pega aqu√≠ arriba
  </div>
</div>

<!-- ESTAD√çSTICAS -->
<div class="stats" id="statsBox" style="display:none">
  <div class="stat"><div class="stat-num" id="stTotal">0</div><div class="stat-label">Total predios</div></div>
  <div class="stat"><div class="stat-num" id="stVenta">0</div><div class="stat-label">En Venta</div></div>
  <div class="stat"><div class="stat-num" id="stArriendo">0</div><div class="stat-label">En Arriendo</div></div>
  <div class="stat"><div class="stat-num" id="stAmbas">0</div><div class="stat-label">Venta + Arriendo</div></div>
  <div class="stat"><div class="stat-num" id="stPereira">0</div><div class="stat-label">En Pereira</div></div>
  <div class="stat"><div class="stat-num" id="stDosq">0</div><div class="stat-label">En Dosquebradas</div></div>
</div>

<!-- PASO 2 -->
<div class="card">
  <div class="card-head">
    <div class="card-icon ci-green">üîç</div>
    <div class="card-title">Paso 2: Consultar Predios</div>
  </div>
  <div class="card-sub">Escribe en lenguaje natural lo que necesita tu cliente</div>
  
  <div class="input-wrap">
    <span class="search-icon">üîç</span>
    <input class="search-input" id="q" placeholder="Ej: Apartamentos en arriendo en Pereira bajo 2 millones..." onkeypress="if(event.key==='Enter')buscar()">
    <button class="search-btn" onclick="buscar()">üöÄ</button>
  </div>
  
  <div class="chips">
    <span class="chip" onclick="q('apartamentos en venta')">üè¢ Aptos en venta</span>
    <span class="chip" onclick="q('apartamentos en arriendo')">üè¢ Aptos en arriendo</span>
    <span class="chip" onclick="q('casas en venta')">üè° Casas en venta</span>
    <span class="chip" onclick="q('casas en arriendo')">üè° Casas en arriendo</span>
    <span class="chip" onclick="q('venta y arriendo')">üîÑ Venta + Arriendo</span>
    <span class="chip" onclick="q('Dosquebradas')">üìç Dosquebradas</span>
    <span class="chip" onclick="q('Pereira')">üìç Pereira</span>
    <span class="chip" onclick="q('casas campestres')">üåø Casas campestres</span>
    <span class="chip" onclick="q('todo disponible')">‚úÖ Ver todos</span>
  </div>
</div>

<!-- RESULTADOS -->
<div id="res"></div>

</div>

<script>
let datos = [];

function q(txt){ document.getElementById('q').value=txt; buscar(); }

// CSV parser robusto - maneja comillas, comas dentro de campos
function parseCSVLine(line){
  const r=[]; let cur=''; let inQ=false;
  for(let i=0;i<line.length;i++){
    if(line[i]==='"'){ inQ=!inQ; continue; }
    if(line[i]===','&&!inQ){ r.push(cur.trim()); cur=''; continue; }
    cur+=line[i];
  }
  r.push(cur.trim());
  return r;
}

function cargar(){
  const csv=document.getElementById('csv').value.trim();
  const st=document.getElementById('st');
  if(!csv){ st.innerHTML='<div class="toast err">‚ö†Ô∏è Por favor pega el CSV primero</div>'; return; }

  try{
    const lineas=csv.split('\n').filter(l=>l.trim().length>2);
    if(lineas.length<2) throw new Error('El CSV parece estar vac√≠o');

    // Headers en √≠ndice 0
    const hdrs=parseCSVLine(lineas[0]).map(h=>h.toLowerCase().trim().replace(/\s+/g,' '));

    datos=[];
    for(let i=1;i<lineas.length;i++){
      const vals=parseCSVLine(lineas[i]);
      if(vals.length<3) continue;
      const obj={};
      hdrs.forEach((h,j)=>{ obj[h]=(vals[j]||'').trim(); });
      datos.push(obj);
    }

    // Mostrar stats
    mostrarStats();
    st.innerHTML=`<div class="toast ok">üéâ ¬°Listo! Se cargaron <strong>${datos.length} predios</strong> correctamente. Ya puedes buscar abajo üëá</div>`;
    document.getElementById('csv').value='';
    document.getElementById('q').focus();

  } catch(e){
    st.innerHTML=`<div class="toast err">‚ùå Error: ${e.message}</div>`;
  }
}

function mostrarStats(){
  const box=document.getElementById('statsBox');
  box.style.display='grid';

  const venta=datos.filter(p=>esVenta(p)&&!esAmbas(p)).length;
  const arriendo=datos.filter(p=>esArriendo(p)&&!esAmbas(p)).length;
  const ambas=datos.filter(p=>esAmbas(p)).length;
  const pereira=datos.filter(p=>ciudad(p).includes('pereira')).length;
  const dosq=datos.filter(p=>ciudad(p).includes('dosquebradas')).length;

  document.getElementById('stTotal').textContent=datos.length;
  document.getElementById('stVenta').textContent=venta;
  document.getElementById('stArriendo').textContent=arriendo;
  document.getElementById('stAmbas').textContent=ambas;
  document.getElementById('stPereira').textContent=pereira;
  document.getElementById('stDosq').textContent=dosq;
}

// Helpers para extraer datos del CSV real
function get(obj,...keys){
  for(const k of keys){
    for(const h of Object.keys(obj)){
      if(h.toLowerCase().includes(k.toLowerCase())){
        const v=obj[h]||'';
        if(v&&v!=='N/A'&&v!='NO APLICA'&&v!='SIN INFORMACION'&&v!='NO TIENE') return v;
      }
    }
  }
  return '';
}

function negocio(p){ return (get(p,'tipo de negociaci','negociaci','negocio')||'').toLowerCase(); }
function ciudad(p){ return (get(p,'ubicaci','ciudad')||'').toLowerCase(); }
function tipo(p){ return (get(p,'tipo de inmueble','tipo')||'').toLowerCase(); }
function estado(p){ return (get(p,'estado actual','estado')||'').toLowerCase(); }

function esVenta(p){ const n=negocio(p); return n.includes('venta'); }
function esArriendo(p){ const n=negocio(p); return n.includes('arriendo')||n.includes('renta'); }
function esAmbas(p){ const n=negocio(p); return n.includes('venta')&&(n.includes('arriendo')||n.includes('renta')); }

function buscar(){
  const res=document.getElementById('res');
  const q=document.getElementById('q').value.trim().toLowerCase();
  if(!q){ 
    res.innerHTML='<div class="empty"><div class="empty-emoji">ü§î</div><h3>¬øQu√© est√°s buscando?</h3><p>Escribe lo que necesita tu cliente</p></div>'; 
    return; 
  }
  if(!datos.length){ 
    res.innerHTML='<div class="empty"><div class="empty-emoji">üìã</div><h3>Primero carga los datos</h3><p>Completa el Paso 1 arriba</p></div>'; 
    return; 
  }

  res.innerHTML='<div class="loader"><div class="dots"><div class="d"></div><div class="d"></div><div class="d"></div></div><p style="margin-top:16px;color:var(--muted)">Buscando predios... üîç</p></div>';

  setTimeout(()=>{
    const filtrados=filtrar(q);
    render(filtrados,q);
  },350);
}

function filtrar(q){
  return datos.filter(p=>{
    const t=tipo(p);
    const n=negocio(p);
    const c=ciudad(p);
    const dir=(get(p,'direccion','direcci√≥n')||'').toLowerCase();

    // TIPO DE INMUEBLE
    if(/apartamento|apto\b/i.test(q) && !t.includes('apartamento') && !t.includes('apto')) return false;
    if(/\bcasa\b/i.test(q) && !t.includes('casa')) return false;
    if(/local/i.test(q) && !t.includes('local')) return false;
    if(/oficina/i.test(q) && !t.includes('oficina')) return false;
    if(/lote|terreno/i.test(q) && !t.includes('lote')&&!t.includes('terreno')) return false;
    if(/bodega/i.test(q) && !t.includes('bodega')) return false;
    if(/finca/i.test(q) && !t.includes('finca')) return false;
    if(/campestre/i.test(q) && !t.includes('campestre')) return false;

    // NEGOCIACI√ìN - detecta [ ] VENTA y [ ] ARRIENDO del CSV
    if(/\bventa\b/i.test(q)&&!/arriendo|renta/i.test(q)){
      if(!esVenta(p)) return false;
    }
    if(/arriendo|arrendar|alquiler|renta/i.test(q)&&!/\bventa\b/i.test(q)){
      if(!esArriendo(p)) return false;
    }
    if(/(venta.*arriendo|arriendo.*venta|ambas|los dos)/i.test(q)){
      if(!esAmbas(p)) return false;
    }

    // CIUDAD / UBICACI√ìN
    const ciudadesQuery=['pereira','dosquebradas','santa rosa','condina','cerritos','cuba','alcala','combia','pinares'];
    for(const cv of ciudadesQuery){
      if(q.includes(cv)){
        if(!c.includes(cv)&&!dir.includes(cv)) return false;
        break;
      }
    }

    // PRECIO M√ÅXIMO en millones
    const pmMatch=q.match(/(?:bajo|hasta|m√°ximo|max|menos de)\s*(\d+[\.,]?\d*)\s*(?:m|mill|millon|millones)?/i);
    if(pmMatch){
      const num=parseFloat(pmMatch[1].replace(',','.'));
      const maxP=num<1000?num*1000000:num;
      const pv=limpiarPrecio(get(p,'precio de venta','precio venta'));
      const pa=limpiarPrecio(get(p,'precio de arriendo','precio arriendo','canon'));
      if(/arriendo|renta/i.test(q)&&pa>0&&pa>maxP) return false;
      if(/\bventa\b/i.test(q)&&pv>0&&pv>maxP) return false;
      if(!(/arriendo|renta|\bventa\b/i.test(q))){
        const mejor=pv||pa||0;
        if(mejor>0&&mejor>maxP) return false;
      }
    }

    // PRECIO M√çNIMO
    const pminMatch=q.match(/(?:desde|desde|m√°s de|mayor de|sobre)\s*(\d+[\.,]?\d*)\s*(?:m|mill|millon|millones)?/i);
    if(pminMatch){
      const num=parseFloat(pminMatch[1].replace(',','.'));
      const minP=num<1000?num*1000000:num;
      const pv=limpiarPrecio(get(p,'precio de venta','precio venta'));
      const pa=limpiarPrecio(get(p,'precio de arriendo','precio arriendo','canon'));
      const mejor=pv||pa||0;
      if(mejor>0&&mejor<minP) return false;
    }

    // HABITACIONES
    const habMatch=q.match(/(\d+)\s*(?:hab|habitacion|cuarto|alcoba)/i);
    if(habMatch){
      const minH=parseInt(habMatch[1]);
      const h=parseInt(get(p,'habitaciones')||'0');
      if(h>0&&h<minH) return false;
    }

    // TODO (sin filtros extra)
    // Si pide "todos" o "todo disponible" retorna sin m√°s filtros
    return true;
  });
}

function limpiarPrecio(v){
  if(!v) return 0;
  const n=parseFloat(String(v).replace(/[^\d.]/g,''));
  return isNaN(n)?0:n;
}

function fmt(v){
  const n=limpiarPrecio(v);
  if(!n||n<=0) return null;
  if(n>=1000000000) return (n/1000000000).toFixed(1).replace(/\.0$/,'')+'B';
  if(n>=1000000) return '$'+Math.round(n/1000000).toLocaleString('es-CO')+'M';
  return '$'+n.toLocaleString('es-CO');
}

function render(predios,q){
  const res=document.getElementById('res');

  if(!predios.length){
    res.innerHTML=`
      <div class="empty">
        <div class="empty-emoji">üîç</div>
        <h3>Sin resultados</h3>
        <p>No encontr√© predios para "<strong>${q}</strong>"</p>
        <p style="margin-top:8px;font-size:13px">Prueba con t√©rminos m√°s generales o una ciudad diferente</p>
      </div>`;
    return;
  }

  let html=`
    <div class="results-bar">
      <div class="results-title">üéØ <b>${predios.length}</b> ${predios.length===1?'predio':'predios'} encontrado(s)</div>
    </div>
    <div class="grid">`;

  predios.slice(0,50).forEach((p,i)=>{
    const t=get(p,'tipo de inmueble','tipo')||'Inmueble';
    const dir=get(p,'direccion','direcci√≥n')||'Sin direcci√≥n';
    const cv=get(p,'ubicaci','ciudad')||'';
    const cod=get(p,'c√≥digo','codigo','metrocuadrado')||'';
    const asesor=get(p,'asesor')||'';
    const est=get(p,'estado actual','estado')||'';
    const obs=get(p,'observaciones','observacion')||'';
    
    const pv=get(p,'precio de venta','precio venta');
    const pa=get(p,'precio de arriendo','precio arriendo','canon');
    const admon=get(p,'administraci','admon','valor admin')||'';
    
    const area=get(p,'√°rea construida','area construida','√°rea','area')||'';
    const hab=get(p,'habitaciones')||'';
    const banos=get(p,'ba√±os','banos')||'';
    const estrato=get(p,'estrato')||'';
    const antig=get(p,'antig√ºedad','antiguedad','antig√ºedad')||'';

    const ambas=esAmbas(p);
    const venta=esVenta(p)&&!ambas;
    const arriendo=esArriendo(p)&&!ambas;

    const headCls=ambas?'h-ambas':venta?'h-venta':'h-arriendo';
    const emoji=getEmoji(t);

    const bVenta=venta||ambas?`<span class="badge bv">üí∞ Venta</span>`:'';
    const bArr=arriendo||ambas?`<span class="badge ba">üîë Arriendo</span>`:'';
    const bEst=est?`<span class="badge be">üìå ${est}</span>`:'';

    const precioVenta=fmt(pv)?`<div class="price-main">${fmt(pv)} <small>venta</small></div>`:'';
    const precioArr=fmt(pa)?`<div class="price-rent">üîë ${fmt(pa)}/mes arriendo</div>`:'';
    const admStr=fmt(admon)?`<span class="spec">üè¢ Admon ${fmt(admon)}</span>`:'';

    const specs=[
      hab&&hab!='0'?`<span class="spec">üõèÔ∏è ${hab} hab</span>`:'',
      banos&&banos!='0'?`<span class="spec">üöø ${banos} ba√±os</span>`:'',
      area?`<span class="spec">üìê ${area} m¬≤</span>`:'',
      estrato&&estrato!='SIN INFORMACION'?`<span class="spec">‚≠ê Est ${estrato}</span>`:'',
      antig&&antig!='SIN INFORMACION'?`<span class="spec">üïê ${antig}</span>`:'',
      admStr,
    ].filter(Boolean).join('');

    const dualNote=ambas?`<div class="dual-alert">‚ö†Ô∏è <div><strong>Predio con doble modalidad:</strong> Disponible en VENTA y ARRIENDO. Informe ambas opciones al cliente.</div></div>`:'';

    const obsHtml=obs&&obs.length>3&&obs!='N/A'?`<div class="obs">üìù ${obs.slice(0,120)}${obs.length>120?'...':''}</div>`:'';
    const asesorHtml=asesor&&asesor!='N/A'&&asesor!='NO TIENE'?`<div class="asesor-row">üë§ Asesor: <strong>${asesor}</strong></div>`:'';

    html+=`
    <div class="pc" style="animation-delay:${Math.min(i*0.04,0.6)}s">
      <div class="pc-head ${headCls}">
        ${cod?`<span class="pc-codigo">${cod}</span>`:''}
        <div class="pc-emoji">${emoji}</div>
        <div class="pc-tipo">${t}</div>
        <div class="pc-dir">${dir}</div>
        <div class="pc-ciudad">üìç ${cv}</div>
      </div>
      <div class="pc-body">
        <div class="badges-row">${bVenta}${bArr}${bEst}</div>
        ${precioVenta}${precioArr}
        ${specs?`<div class="specs-row">${specs}</div>`:''}
        ${dualNote}
        ${obsHtml}
        ${asesorHtml}
      </div>
    </div>`;
  });

  html+='</div>';
  res.innerHTML=html;
  setTimeout(()=>res.scrollIntoView({behavior:'smooth',block:'start'}),100);
}

function getEmoji(t){
  t=(t||'').toLowerCase();
  if(t.includes('apto')||t.includes('apartamento')) return 'üè¢';
  if(t.includes('campestre')) return 'üåø';
  if(t.includes('casa')) return 'üè°';
  if(t.includes('local')) return 'üè™';
  if(t.includes('oficina')) return 'üíº';
  if(t.includes('lote')||t.includes('terreno')) return 'üå≥';
  if(t.includes('bodega')) return 'üè≠';
  if(t.includes('finca')) return 'üåæ';
  return 'üè†';
}
</script>
</body>
</html>
